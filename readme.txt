================================================================================
 【 ソフト名 】 るなぽMT
 【バージョン】 Final
 【ランタイム】 .NET Framework 3.5
 【 開発環境 】 Windows XP  +  Visual C++ 2008 Express Edition
 【   備考   】 転載等は自己責任で
================================================================================

■ 概要
  「2D格闘ツクール2nd.」用UDPチャット機能付きネット対戦支援ツールです。
  「LunaPort r11/r38」を参考に作成しましたが、互換性は一切ありません。
  動作には「.NET Framework 3.5」が必要になります。
  プログラムが起動しない人は↓から手に入れてきてください。

  .NET Framework デベロッパー センター
  http://msdn.microsoft.com/ja-jp/netframework/default.aspx

  上のほうにある「ダウンロード」から「.NET Framework 3.5 を手に入れる」で入手できます。

  本家オリジナルLunaPortの配布場所はここです。
  http://lunaport.pastebin.com/

  2000ユーザの方は有志が作成してくれた「Win2k対応版」の方を使用してください。
  その際必要になるランタイムは「.NET Framework 2.0」です。

  Vistaユーザの方は、互換モードを変更することで動作するようになる、との報告があります。
  うまく動作しない場合には、互換モードをXPに変更するなどして試してみてください。


■ 注意
  当ソフトウェアはエンターブレインの許可を取らずに作成してあります。
  使用や配布の停止要請が来た場合には、直ちに従ってください。
  また、発生したバグや問題点をエンターブレインやゲーム製作者に問い合わせるのは、絶対に止めください。


■ 機能一覧
・チャット
・ネット対戦
・リプレイの保存/再生
・観戦

  UDPの特性上、相手にパケットが届かないこともあるので、大事なことは２度言ってください。
  ネット対戦中の左右キーの同時入力は、自動的に左キー入力に変更されます。
  蔵同士でもPingが帰ってくるようならば、ネット対戦が出来る可能性があります。

  観戦は対象が対戦を開始しても、５秒くらいまでなら観戦できます。
  また、相手がどのような状態(リプレイファイルの再生等)でも観戦対象に出来ます。
  ただし、負担を減らすため同期など細かい手順は全て省いてますので、
  対戦とは比べ物にならないほどタイムアウトが出やすくなってます。

  観戦する人を観戦することで、パケットのリレーが行えます。(観戦リレー)
  これによりネット対戦者の負担を減らすことが可能……だといいな。


■ 画面説明
┏━┳━━━┓  ① メンバーリスト
┃  ┃  ②  ┃
┃①┃      ┃  ② ログウィンドウ
┃  ┣━③━┫
┗━┻━━━┛  ③ 入力欄


■ 使い方
  起動するとスタートアップダイアログが表示されます。

フリープレイ : ネット接続せずにプログラムを起動します。

[モード選択]
・Server(鯖) : 鯖を立て、蔵を受け入れるようにします。鯖名は32文字まで。
・Host       : ポートを開放した状態で鯖に接続します。確実にネット対戦が出来そうな蔵です。
・Client(蔵) : ポートを開放せずに鯖に接続します。ポート開放が無理そうな時はこのモードで起動してください。

・開放ポート : 接続の待ち受けをするポートです。
               事前にルータ等の設定で開放したポート番号を入力してください。
               デフォルトでは、UDP:7500を使用します。
               サーバはUDP:7500推奨ですが、Hostは開いてさえいれば好きなポートでかまいません。

  サーバ名のはじめに"@"を付ける事で、チャット禁止サーバを立てることが出来ます。
  ひたすら対戦しまくりたい時に利用してください。

[オプション]
・ニックネーム : メンバーリストに表示される名前です。
・コメント     : 入室時、及びポップアップに表示される文章です。一言添えたい時にどうぞ。
・最大接続数   : サーバ及び観戦で受け入れる最大人数を設定します。
                 後でいくらでも好きに変更できますので適当に入力しても大丈夫です。
・接続ポート   : サーバが開放しているポートを設定します。
                 サーバによっては7500以外のポートを使用している場合がありますので、その際は変更してください。

[Welcomeメッセージ]
  クライアントがサーバ接続時に表示されるメッセージを編集できます。

  人を募りたい時はServer、他の人が立てた鯖に入りたい時はHost/Clientを選択し、
  鯖名やIPを入力して[OK]を押してください。
  フリープレイで起動すると、ネット対戦や観戦等は出来ませんが、
  リプレイファイルを見たり一人プレイで遊んだりすることは出来ます。


■ メンバーリスト
  Server/Host/Clientの違いで文字の色が、対戦中/休憩中/観戦中で背景の色が変わります。
  マウスでの操作は以下の通り。

[左ダブルクリック]
  ダブルクリックした対象により、いくつかの機能が使用できます。
  
・自分     : 休憩状態の切り替えや、対戦/観戦の中止が出来ます。
・メンバー : 状態を再取得します。
・それ以外 : メンバーリストの表示を切り替えます。

[右クリック]
・対戦する : 選んだ人と対戦します。自分で自分に対戦すると一人プレイ用にゲームを起動します。
・観戦する : 選んだ人のプレイを観戦します。なお、休憩中でも観戦は可能です。
・Ping     : ちょっとした回線チェックにどうぞ。

休憩状態 : 休憩中の人にはネット対戦を申し込むことが出来なくなります。
           休憩中でも観戦は可能なため、一息入れたい時などにどうぞ。


■ オプション

◆ 設定
  オプションダイアログが表示されます。

[パス]
  ドラッグ＆ドロップによるパスの指定も可能です。

<基本パス>
実行ファイル         : ゲーム実行に必要なパスを設定します。これが適切に設定されていないとまともに動きません。
リプレイ保存フォルダ : リプレイファイルを保存するフォルダです。

<音声ファイル>
対戦のお知らせ : 対戦を申し込まれた時に再生されます。
告知のお知らせ : サーバからの告知メッセージを受信した時に再生されます。


[ゲーム]

<ステージ>
最大ステージ数 : ゲームが使用しているステージ数を設定します。
                 プレイするゲームより多くのステージ数を設定した場合、エラーを起こします。
対戦ステージ   : 0を選ぶことで、対戦ステージがランダムで選ばれるようになります。

<リプレイファイル>
圧縮する     : 実行速度を犠牲に、ファイルサイズを小さくすることが出来ます。
無圧縮       : ファイルサイズは大きくなりますが、実行速度は速くなります。
自動振り分け : ゲームごとにフォルダを作成し、そこにファイルを保存するようにします。

<格ツク>
当たり判定の表示 : 格ツクのHitJudgeを有効にします。
640 x 480 で起動 : ゲーム起動時に"game.ini"のウィンドウサイズを変更します。

<タイトルバー>
ニックネーム     : プレイヤー名、及び対戦者名を表示します。
対戦数           : 対戦回数と勝利回数を表示します。
フレームレート   : 一秒間に画面が更新された回数です。体感速度に影響します。60を下回るとカクついてきます。
インプットレート : 格ツクのfps相当です。これが100出ているのかどうかの方が、フレームレートよりも大事です。

<フェイクタイマー>
  おまけで付いているなんちゃって偽タイマーです。
  以下のような機能があります。

・タイマーの表示場所は、タイトルバーの< 数字 >
・タイムアップになったら、残り体力の割合が少ない方を強制的に0にする
・どちらかが「攻撃」or「やられ」状態の間は、タイムアップせずカウンターストップ

<回線設定>
最大接続数 : スタートアップ時の設定と同じです。


[カラー]
  各カラーの変更が行えます。
  デフォルトカラーに戻したい時は、プログラムが起動していない状態で、
  iniファイルの[Color]セクションを削除してください。
  言ってることがよくわからなかったら、ini自体を削除するのが手っ取り早いです。


◆ ディレイ
  ネット対戦時に、キー入力から実際に反映されるまでのフレーム数です。
  少ないほど動作が機敏になりますが、ラグが発生しやすくなります。
  逆に大きいほど緩慢になる代わりに安定しますが、いざラグが発生した時の被害が大きくなります。
  こればかりは回線相性に左右されるので、いろいろ試して適切な値を探してください。

[Auto]
  対戦を申し込まれる方(Host側)をP1、申し込む方(Client側)をP2とします。

  ネット対戦時は両者の設定値で数値の大きい方に合わせます。
  P2がAutoに設定してある場合、対戦直前に回線速度を計りディレイ値を計算します。

  Delay = (Ping / 10) + 2    Max:9

  << よくわかる Delay Auto >>
  ・ P2 : Pingを使ってディレイを計算し、P1に渡す
                    ↓
  ・ P1 : Autoなら値をそのまま、数値を指定していたら大きい方の値を返す
                    ↓
  ・ P2 : 返ってきたディレイ値を使う
  
      P1    P2
     数値  数値  :  大きい方
     Auto  数値  :  P2の値
     Auto  Auto  :  計算値
     数値  Auto  :  計算値とP1の値を比べて大きい方

◆ リプレイファイルの保存
  チェックしていると、リプレイの再生以外で起動したゲームのリプレイを保存します。
  気がつくと異常な数のファイルが溜まっていて、整理を投げ出したくなります。

◆ 観戦の許可
  「最大接続数」で設定した人数分、観戦者を受け入れることが出来ます。
  また、観戦者がいる状態でチェックをはずすと、全ての観戦者を追い出します。
  多少なりとも対戦に影響が出るので、回線やマシンスペックに余裕がないときは切っておきましょう。

◆ ネット対戦後に一息入れる
  ネット対戦後に自動で休憩状態に入ります。
  対戦の後は優雅なティータイムで過ごしたい……そんなセレブにオススメの設定です。


■ 入力欄あれこれ

◆ 告知
  サーバの人はメッセージを入力後、Ctrlキーを押しながらEnterキーを押すことで、
  チャットの可否に関わらず、メンバー全員に告知メッセージを送信することが出来ます。
  その際、メッセージに"_"(アンダースコア)が含まれていた場合、改行に自動変換されます。

  例えば「告知_メッセージ_です」と入力して送信すると、以下のように表示されます。

  告知
  メッセージ
  です

◆ コマンドの説明
  入力欄で"/"から始まるテキストを入力すると、いろいろな機能が使えたりします。

・/help    : コマンドの一覧を表示します。

・/clear   : 全てのログを削除します。

・/log     : 色つきテキストのRTF形式でログを保存します。
             ショートカットなどからログの保存を選んだ場合はTXT形式になります。

・/debug   : デバッグモードを切り替えます。デフォルトはオフです。
             オンの場合、デバッグに役立ちそうな情報を表示するようになりますが、ログが流れやすくなります。
             流れやすくなるだけで済めばいいのですが、対戦中は目に見えてfpsが下がります。
             またオンにした状態でプログラムを終了させると、"log.rtf"というログファイルが勝手に作られます。

・/vs      : ネット接続時＆自分がフリー状態の時のみ使用可能です。
             ランダムに選んだメンバーに対戦を挑みます。

・/game    : 一人用モードでゲームを起動します。

・/replay  : 保存していたリプレイファイルを再生します。

・/quit    : 起動中のゲームを終了させます。

・/restart : フリープレイの時のみ使用可能。プログラムをモード選択からやり直します。

・/rest    : 休憩状態の切り替えを行います。

・/list    : リストの表示を名前とコメントで切り替えます。

・/leave   : 鯖主なら鯖のシャットダウンを、蔵なら鯖から退室し、フリープレイに移行します。

・/exit    : プログラムを終了します。




■ 後書
  Ｑ．なんか きゅうに めっちゃ おもく なった うぼぁー
  Ａ．「ガベージコレクション」といって、メイドさんがメモリのお掃除をしてるのかも

  コメントはあくまでもおまけ的なものと考えてね
  見てない人は結構いるんじゃないかな？

  VC++2005EEがゲットできたので2k版も同封です
  いつ消えるかわからないので、欲しい人は早めにゲットだ
  http://www.microsoft.com/japan/msdn/vstudio/express/maninstall/


  というわけで、るなぽMT最終バージョンになります
  今まで応援ありがとうございました
  短い間だったが、いろいろ学べて面白かったぜ！
  あとは本家とＷの人、任せた

  あ、サポートは継続して行うので、なんかあったら適当に書いておいてください
  目に付き次第、プログラムに蹴りかましてきます
